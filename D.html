<!DOCTYPE html>
<html lang="km">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Akima Topup - Pro Realtime Sync</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;600;700&family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root { 
    --bg: #0f0a1e; --surface: #1c1433; --primary: #a855f7; 
    --primary-glow: rgba(168, 85, 247, 0.4); --text-main: #f3f4f6; 
    --text-dim: #a78bfa; --border: rgba(168, 85, 247, 0.2); --promo-bg: #ff4757;
}

* { box-sizing: border-box; font-family: 'Kantumruy Pro', 'Poppins', sans-serif; transition: all 0.2s ease; }
body { margin: 0; background: var(--bg); color: var(--text-main); background-image: radial-gradient(circle at top right, #2d1b4d, transparent); background-attachment: fixed; overflow-x: hidden; }

header { background: rgba(15, 10, 30, 0.85); backdrop-filter: blur(15px); border-bottom: 1px solid var(--border); padding: 12px 20px; position: sticky; top: 0; z-index: 1000; }
.logo-container { display: flex; align-items: center; gap: 10px; cursor: pointer; }
.main-logo { width: 45px; height: 45px; object-fit: contain; filter: drop-shadow(0 0 5px var(--primary)); }
.brand-name { font-size: 20px; font-weight: 800; background: linear-gradient(to right, #ffffff, var(--primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

.banner-container { margin: 15px; border-radius: 15px; overflow: hidden; border: 1px solid var(--border); height: 160px; position: relative; background: #000; }
.slide { display: flex; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); height: 100%; }
.slide img { width: 100%; object-fit: cover; flex-shrink: 0; }
.dots { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; }
.dot { width: 7px; height: 7px; background: rgba(255,255,255,0.3); border-radius: 50%; }
.dot.active { background: var(--primary); width: 18px; border-radius: 10px; }

.container { padding: 0 15px 120px; max-width: 600px; margin: auto; }
.section-title { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin: 25px 0 15px; color: var(--primary); display: flex; align-items: center; gap: 8px; }
.section-title::after { content: ""; height: 1px; flex: 1; background: var(--border); }

.game-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
.game-item { background: var(--surface); border-radius: 15px; padding: 10px; text-align: center; border: 1px solid var(--border); cursor: pointer; }
.game-item img { width: 100%; aspect-ratio: 1/1; border-radius: 10px; object-fit: cover; }
.game-item p { margin: 8px 0 0; font-size: 13px; font-weight: 600; }

.price-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
.price-item { 
    position: relative; overflow: hidden; display: flex; flex-direction: column; 
    justify-content: center; align-items: center; background: rgba(255,255,255,0.03); 
    border: 1px solid var(--border); padding: 18px 5px; border-radius: 12px; cursor: pointer;
}
.price-item.selected { background: rgba(168, 85, 247, 0.15); border-color: var(--primary); box-shadow: 0 0 10px var(--primary-glow); }
.price-item.out-of-stock { opacity: 0.4; cursor: not-allowed; filter: grayscale(1); pointer-events: none; }
.out-badge { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); background: #ff4757; color: white; padding: 2px 10px; border-radius: 4px; font-size: 10px; font-weight: 800; z-index: 10; white-space: nowrap; }

.promo-badge { position: absolute; top: 0; right: 0; background: var(--promo-bg); color: white; font-size: 9px; padding: 2px 8px; border-radius: 0 0 0 10px; font-weight: 700; }
.price-item b { font-size: 12px; color: var(--text-dim); margin-bottom: 2px; font-weight: 400; }
.price-item span { font-size: 16px; font-weight: 700; color: var(--primary); }

.input-group { background: var(--surface); padding: 15px; border-radius: 15px; border: 1px solid var(--border); }
input { width: 100%; padding: 12px; border-radius: 10px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: white; outline: none; font-size: 15px; margin-bottom: 10px; }
input:focus { border-color: var(--primary); box-shadow: 0 0 5px var(--primary-glow); }

.bottom-bar { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(28,20,51,0.95); backdrop-filter: blur(15px); padding: 15px 25px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; transform: translateY(100%); z-index: 2000; }
.bottom-bar.show { transform: translateY(0); }
.btn-primary { background: linear-gradient(135deg, #a855f7, #7c3aed); color: white; border: none; padding: 12px 30px; border-radius: 10px; font-weight: 700; cursor: pointer; }

.hidden { display: none !important; }
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 3000; padding: 20px; }
.modal-content { background: var(--surface); padding: 25px; border-radius: 20px; width: 100%; max-width: 350px; text-align: center; border: 1px solid var(--border); }
.confirm-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 14px; }

#loader { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; align-items: center; justify-content: center; }
.back-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: white; padding: 8px 12px; border-radius: 10px; cursor: pointer; }

/* Info Alert */
.info-box { background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); color: #f59e0b; padding: 10px; border-radius: 10px; font-size: 12px; margin-bottom: 15px; display: flex; gap: 10px; align-items: flex-start; }
.support-float {
    position: fixed;
    bottom: 90px; /* á“áŸ…á–á¸á›á¾ Bottom Bar á”á“áŸ’áá·á… */
    right: 20px;
    background: #0088cc; /* á–ááŸŒ Telegram */
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    z-index: 1500;
    text-decoration: none;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 136, 204, 0.7); }
    70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(0, 136, 204, 0); }
    100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(0, 136, 204, 0); }
}

</style>
</head>
<body>

<div id="loader"><div><i class="fas fa-circle-notch fa-spin fa-2x" style="color:var(--primary)"></i><p>á€áŸ†á–á»á„á‘á¶á‰á‘á·á“áŸ’á“á“áŸá™...</p></div></div>

<header>
    <div class="logo-container" onclick="goHome()">
        <img src="logo.png" alt="Logo" class="main-logo">
        <span class="brand-name">AKIMA TOPUP</span>
    </div>
</header>

<div id="homeSection">
    <div class="banner-container">
        <div class="slide" id="mainSlide">
            <img src="ban1.jpg">
            <img src="ban2.jpg">
            <img src="ban3.jpg">
        </div>
        <div class="dots" id="bannerDots"></div>
    </div>
    <div id="homePage" class="container">
        <div class="section-title">á áŸ’á‚áŸá˜á–áŸá‰á“á·á™á˜</div>
        <div class="game-grid" id="gameGrid"></div>
    </div>
</div>

<div id="topupPage" class="container hidden">
    <div id="gameLogoHeader" style="margin: 20px 0;"></div>
    
    <div class="section-title">á–áŸááŸŒá˜á¶á“á‚áá“á¸</div>
    <div class="input-group">
        <div class="info-box">
            <i class="fas fa-exclamation-triangle"></i>
            <span>áŸá¼á˜á–á·á“á·ááŸ’á™ ID á“á·á„ Zone á±áŸ’á™á”á¶á“ááŸ’ášá¹á˜ááŸ’ášá¼áœá”áŸ†á•á»á áŠá¾á˜áŸ’á”á¸á‡áŸ€áŸáœá¶á„á€á¶ášá”á‰áŸ’á…á¼á›áá»áŸáŸ”</span>
        </div>
        <div id="mlInputs" class="hidden">
            <div style="display:flex; gap:10px;">
                <input type="number" id="mlId" placeholder="á”á‰áŸ’á…á¼á› Player ID">
                <input type="number" id="mlSrv" placeholder="Zone" style="width:100px;">
            </div>
        </div>
        <input type="text" id="genId" class="hidden" placeholder="á”á‰áŸ’á…á¼á› ID á áŸ’á‚áŸá˜ášá”áŸáŸ‹á¢áŸ’á“á€">
    </div>
<div class="section-title">á‡áŸ†á“á½á™ á“á·á„á€á¶ášááŸ‚á“á¶áŸ†</div>
<div class="input-group" style="background: rgba(168, 85, 247, 0.05);">
    <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: var(--text-dim); line-height: 1.8;">
        <li>á”á‰áŸ’á…á¼á›á›á»á™á”á¶á“ášá áŸáŸá€áŸ’á“á»á„ášá™áŸˆá–áŸá› 1-5 á“á¶á‘á¸áŸ”</li>
        <li>á”áŸ’ášáŸá·á“á”á¾á˜á¶á“á”á‰áŸ’á á¶ á¬á”á‰áŸ’á…á¼á›á˜á·á“á…á¼á› áŸá¼á˜á‘á¶á€áŸ‹á‘á„á˜á€á€á¶á“áŸ‹á–á½á€á™á¾á„áŸ”</li>
        <li>ášá€áŸ’áŸá¶á‘á»á€áœá·á€áŸ’á€á™á”ááŸ’ášá”á„áŸ‹á”áŸ’ášá¶á€áŸ‹ (Screenshot) ášá”áŸáŸ‹á¢áŸ’á“á€á‡á¶á“á·á…áŸ’á…áŸ”</li>
    </ul>
    <div style="margin-top: 15px; text-align: center;">
        <a href="https://t.me/YOUR_USERNAME" style="color: var(--primary); text-decoration: none; font-weight: 700; font-size: 14px;">
            <i class="fab fa-telegram"></i> á†á¶áá˜á€á€á¶á“áŸ‹á•áŸ’á“áŸ‚á€ Support
        </a>
    </div>
</div>

    <div class="section-title">á‡áŸ’ášá¾áŸášá¾áŸá€á‰áŸ’á…á”áŸ‹</div>
    <div class="price-grid" id="priceContainer"></div>
</div>

<div id="bottomBar" class="bottom-bar">
    <div><small style="color:var(--text-dim); display:block; font-size:10px;">áŸášá»á”ááŸ’ášá¼áœá”á„áŸ‹</small><span id="totalTxt" style="font-size:20px; font-weight:800; color:var(--primary);">$0.00</span></div>
    <button class="btn-primary" onclick="processOrder()">á”á„áŸ‹á”áŸ’ášá¶á€áŸ‹</button>
</div>

<div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
        <h3 style="color:var(--primary); margin-top:0;">á”á‰áŸ’á‡á¶á€áŸ‹á€á¶ášá”á‰áŸ’á‡á¶á‘á·á‰</h3>
        <div id="confirmDetails"></div>
        <p style="font-size: 11px; color: #ff4757; margin-top: 15px;">*á€á¶ášá‘á·á‰ášá½á…á˜á·á“á¢á¶á…á”áŸ’áá¼ášáœá·á‰á”á¶á“á‘áŸ</p>
        <div style="display:flex; gap:10px; margin-top:10px;">
            <button onclick="closeModal()" style="flex:1; background:none; border:1px solid var(--border); color:white; padding:10px; border-radius:10px;">á”áŸ„áŸ‡á”á„áŸ‹</button>
            <button onclick="finalSubmit()" style="flex:1; background:var(--primary); border:none; color:white; padding:10px; border-radius:10px; font-weight:700;">á”á“áŸ’á</button>
        </div>
    </div>
</div>
<a href="https://t.me/YOUR_USERNAME" class="support-float" target="_blank">
    <i class="fab fa-telegram-plane"></i>
</a>

<script>
// --- á€áŸ†áááŸ‹á–áŸááŸŒá˜á¶á“ááŸ’ášá„áŸ‹á“áŸáŸ‡ ---
const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRkaa7NhCo8THiMJ8yUUo5Rvi-U-j7A3r0u6laWLZhkbj6kemO_IQxJToRfav6n2ir3MzuhbmX2xBzl/pub?gid=0&single=true&output=csv';
const telegram = { token: '8535872449:AAGpaTQA038wpiNUT5bFfEJcBMgMPAkqnzU', chatId: '-1003573524133' };
const gameLogos = { 'Mobile Legends': 'mlbb.jpg', 'Honor of Kings': 'hok.jpg', 'Free Fire': 'ff.jpg', 'PUBG Mobile': 'pub.jpg' };

let remoteData = {};
let cart = { game: '', item: '', price: 0, player: '', qr: '' };
let currentView = 'home'; 

// áŸ¡. á˜á»áá„á¶áš Sync á‘á·á“áŸ’á“á“áŸá™ (Real-time)
async function syncData(isFirstTime = false) {
    try {
        // á”á“áŸ’ááŸ‚á˜ Time stamp áŠá¾á˜áŸ’á”á¸á€á¶ášá–á¶áš Browser á€á»áŸ†á±áŸ’á™á‘á¶á‰á™á€á€á¼áŠá…á¶áŸáŸ‹ (Clear Cache)
        const response = await fetch(`${SHEET_CSV_URL}&t=${new Date().getTime()}`);
        const csvText = await response.text();
        const rows = csvText.split('\n').slice(1);
        
        let newData = {};
        rows.forEach(row => {
            const [game, name, price, link, promo, stock] = row.split(',').map(c => c?.trim());
            if(!game) return;
            if(!newData[game]) newData[game] = [];
            newData[game].push({ name, price: parseFloat(price), link, promo, stock: stock?.toLowerCase() });
        });

        remoteData = newData;

        if(isFirstTime) {
            document.getElementById('loader').style.display = 'none';
            initHome();
        } else if (currentView !== 'home') {
            // á”á¾á€áŸ†á–á»á„á˜á¾á›á‘áŸ†á–áŸášá áŸ’á‚áŸá˜ á±áŸ’á™áœá¶ Update áá˜áŸ’á›áŸƒá—áŸ’á›á¶á˜áŸ—
            renderPrices(currentView);
        }
    } catch (e) { console.log("Sync Error"); }
}

function initHome() {
    const grid = document.getElementById('gameGrid');
    grid.innerHTML = '';
    Object.keys(remoteData).forEach(g => {
        grid.innerHTML += `<div class="game-item" onclick="openTopUp('${g}')"><img src="${gameLogos[g] || 'logo.png'}"><p>${g}</p></div>`;
    });
}

function openTopUp(game) {
    currentView = game;
    document.getElementById('homeSection').classList.add('hidden');
    document.getElementById('topupPage').classList.remove('hidden');
    document.getElementById('gameLogoHeader').innerHTML = `
        <div style="display:flex; align-items:center; gap:15px;">
            <button class="back-btn" onclick="goHome()"><i class="fas fa-arrow-left"></i></button>
            <img src="${gameLogos[game] || 'logo.png'}" style="width:50px; height:50px; border-radius:12px; border:2px solid var(--primary);">
            <h3 style="margin:0;">${game}</h3>
        </div>`;
    
    document.getElementById('mlInputs').classList.toggle('hidden', game !== 'Mobile Legends');
    document.getElementById('genId').classList.toggle('hidden', game === 'Mobile Legends');
    renderPrices(game);
}

// áŸ¢. á˜á»áá„á¶áš Render áá˜áŸ’á›áŸƒ (á áŸ…á”áŸ’ášá¾á‘á¶áŸ†á„á–áŸá›á”á¾á€áŠáŸ†á”á¼á„ á“á·á„á–áŸá› Sync)
function renderPrices(game) {
    const container = document.getElementById('priceContainer');
    const oldSelection = cart.item; 
    container.innerHTML = '';
    
    remoteData[game]?.forEach(p => {
        const isOut = p.stock === 'out';
        const isSelected = p.name === oldSelection;
        const el = document.createElement('div');
        el.className = `price-item ${isOut ? 'out-of-stock' : ''} ${isSelected ? 'selected' : ''}`;
        el.innerHTML = `${p.promo ? `<div class="promo-badge">${p.promo}</div>` : ''}${isOut ? `<div class="out-badge">á¢áŸáŸ‹áŸáŸ’áá»á€</div>` : ''}<b>${p.name}</b> <span>$${p.price.toFixed(2)}</span>`;
        
        if(!isOut) {
            el.onclick = () => {
                document.querySelectorAll('.price-item').forEach(x => x.classList.remove('selected'));
                el.classList.add('selected');
                cart = { ...cart, item: p.name, price: p.price, qr: p.link };
                document.getElementById('totalTxt').innerText = `$${p.price.toFixed(2)}`;
                document.getElementById('bottomBar').classList.add('show');
            };
        }
        container.appendChild(el);
    });
}

function goHome() {
    currentView = 'home';
    document.getElementById('homeSection').classList.remove('hidden');
    document.getElementById('topupPage').classList.add('hidden');
    document.getElementById('bottomBar').classList.remove('show');
    window.scrollTo(0,0);
}

function processOrder() {
    const mid = document.getElementById('mlId').value;
    const msrv = document.getElementById('mlSrv').value;
    const gid = document.getElementById('genId').value;
    cart.player = currentView === 'Mobile Legends' ? `${mid} (${msrv})` : gid;
    
    if(!cart.player || cart.player.trim() === "" || cart.player.includes('()')) return alert("áŸá¼á˜á”áŸ†á–áŸá‰ ID");
    
    document.getElementById('confirmDetails').innerHTML = `
        <div class="confirm-item"><span>á áŸ’á‚áŸá˜:</span><b>${currentView}</b></div>
        <div class="confirm-item"><span>á€á‰áŸ’á…á”áŸ‹:</span><b>${cart.item}</b></div>
        <div class="confirm-item"><span>ID:</span><b>${cart.player}</b></div>
        <div class="confirm-item"><span>áá˜áŸ’á›áŸƒ:</span><b>$${cart.price.toFixed(2)}</b></div>`;
    document.getElementById('confirmModal').style.display = 'flex';
}

function finalSubmit() {
    const msg = `ğŸš€ NEW ORDER\nğŸ® Game: ${currentView}\nğŸ’ Item: ${cart.item}\nğŸ†” ID: ${cart.player}\nğŸ’° Price: $${cart.price}\nâ° Time: ${new Date().toLocaleString()}`;
    fetch(`https://api.telegram.org/bot${telegram.token}/sendMessage`, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: telegram.chatId, text: msg })
    });
    window.open(cart.qr, '_blank');
    closeModal();
    goHome();
}

function closeModal() { document.getElementById('confirmModal').style.display = 'none'; }

// áŠáŸ†áá¾ášá€á¶áš Sync áŠáŸ†á”á¼á„
syncData(true);

// á€áŸ†áááŸ‹á±áŸ’á™á†áŸ‚á€ Sheet ášáŸ€á„ášá¶á›áŸ‹ áŸ¢áŸ  áœá·á“á¶á‘á¸
setInterval(() => syncData(false), 20000);

</script>
</body>
</html>
